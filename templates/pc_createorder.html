<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Оформление заказа</title>
    {% include 'pc_headers.html' %}
</head>
<body id="body">

<div class="catalog">
    <div class="container">
        <div class="place_breadcoast">
            <a href="/">Главная</a> / <a href="/createorder">Оформление заказа</a>
        </div>

        <div class="catalog_flex createorder">
            <div class="requisites_place">
                <div class="name_buckets">
                    Отправитель
                </div>
                <input class="popup_input" placeholder="Ваше имя">
                <input class="popup_input" type="tel" placeholder="+7 (___) ___-__-__">
                <input class="popup_input" type="email" placeholder="Электронная почта">
                <select id="addresses_user" class="popup_input" style="display: none">

                </select>
                <div class="checkbox" style="margin-left:5px;">
                    <input type="checkbox" id="get_other_people"
                           class="scal_chek custom-checkbox" style="margin-top: 20px;">
                    <label for="get_other_people" class="lab_desc sub_zag">Отправить другому человеку</label>
                </div>
                <div id="recipient">
                    <div class="name_buckets">
                        Получатель
                    </div>
                    <input class="popup_input" placeholder="Имя получателя">
                    <input class="popup_input" type="tel" placeholder="+7 (___) ___-__-__">
                    <input class="popup_input" type="email" placeholder="Адрес получателя">
                </div>
                <div class="name_buckets">
                    Дополнительно
                </div>
                <input class="popup_input" placeholder="Комментарии к заказу">
                <input class="popup_input" placeholder="Текст для открытки">

                <div class="catalog_flex">
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="add_carrying"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="add_carrying" class="lab_desc sub_zag">Добавить переноску</label>
                    </div>
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="add_aquapack"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="add_aquapack" class="lab_desc sub_zag">Добавить аквапак</label>
                    </div>
                </div>


                <div class="name_buckets">
                    Способ оплаты
                </div>
                <div class="catalog_flex">
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="money_payment"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="money_payment" class="lab_desc sub_zag">Наличные</label>
                    </div>
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="card_payment"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="card_payment" class="lab_desc sub_zag">Картой</label>
                    </div>
                </div>

                <div class="all_catalog_href"
                     style="float: none;width:100%;height:60px;justify-content: space-between;padding:0 10px">
                    <div class="pereiti_k_oform">Подтвердить заказ</div>
                    <div style="float: right" class="price final_price">17200 Р</div>
                </div>

            </div>
            <div class="your_order_place">
                <div class="your_order">
                    <div class="name_buckets">
                        Ваш заказ
                    </div>
                    <div class="description_explanations">
                        <div class="catalog_flex">
                            <div class="address_info_zag">
                                Доставка в точное время
                            </div>
                            <span class="fa fa-chevron-down"></span>
                        </div>
                        <div class="catalog_flex">
                            <div class="address_info_zag">
                                06.07.2021
                            </div>
                            <span id="choose_data">Выбрать дату</span>
                        </div>
                        <input type="date" class="popup_input">
                        <div class="catalog_flex">
                            <div class="address_info_zag">
                                21:00
                            </div>
                            <span id="choose_time">Выбрать время</span>
                        </div>
                        <input type="time" class="popup_input">
                    </div>
                    <div class="catalog_flex" style="justify-content: space-between;padding:0">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            Сумма заказа
                        </div>
                        <div class="price_price" style="float: right">
                            16200 Р
                        </div>
                    </div>
                    <div class="registr_indicator" style="background: #293048; margin:10px 0;"></div>
                    <div class="catalog_flex" style="justify-content: space-between">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            + Доставка вовремя
                        </div>
                        <div class="price_price" style="float: right">
                            1000 Р
                        </div>
                    </div>


                    <div class="basket_item_place" style="display: none">

                    </div>

                    <!--                    <div class="catalog_flex" style="align-items: normal;justify-content: normal">-->
                    <!--                        <div class="small_product_card" style="margin-right:15px;">-->
                    <!--                            <div class="small_product_place">-->
                    <!--                                <img src="../static/img/slider_img.png" class="small_product_img">-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                        <div>-->
                    <!--                            <div class="bucket_na_zakaz">-->
                    <!--                                Букет индиго-->
                    <!--                            </div>-->
                    <!--                            <div class="price">-->
                    <!--                                5400 Р-->
                    <!--                            </div>-->
                    <!--                        </div>-->
                    <!--                    </div>-->


                    <!-- Карточка товара в корзине -->
                    <div id="basket_item_place" style="display: none;">
                        <div class="basket_item" id="basket_item" style="display: none;">
                            <div class="catalog_flex" style="justify-content: normal">
                                <div class="small_product_card" style="margin-right:15px;">
                                    <a class="small_product_place">
                                        <img src="../static/img/small_img_main.png" class="small_product_img">
                                    </a>
                                </div>
                                <div class="basket_info_for_order">
                                    <div class="bucket_na_zakaz">
                                        Букет "Индиго"
                                    </div>
                                    <div class="catalog_flex_catalog" style="align-items: center">
                                        <div class="disc_price_bucket" style="margin-right: 15px;">
                                            2 600 Р
                                        </div>
                                        <div class="price">
                                            5400 Р
                                        </div>
                                    </div>
                                    <div class="add_to_basket_place" style="max-width:100%;">
                                        <div class="fa fa-minus" id="minus_counter" onclick="changeCounter(2)"></div>
                                        <div class="counter_place">
                                            <input type="number" class="product_counter_inp" id="counter_product"
                                                   value="1">
                                            <span style="font-weight: 600;">ШТ</span>
                                        </div>
                                        <span class="fa fa-plus"></span>
                                    </div>
                                    <div class="fa fa-times"></div>
                                </div>
                            </div>
                        </div>
                    </div>


                    <div class="catalog_flex" style="justify-content: space-between;margin-bottom: 0px;">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            Итого:
                        </div>
                        <div class="price_price final_price" style="float: right">
                            17200 Р
                        </div>
                    </div>
                    <div class="registr_indicator" style="background: #293048;margin:10px 0;"></div>
                    <input class="popup_input" placeholder="Введите промокод">
                    <div class="all_catalog_href" style="float: none;width:100%;height:50px;">
                        Применить промокод
                    </div>
                    <div class="blog_item_text_zag" style="text-align: center;margin:20px 0;">Платёжные системы</div>
                    <div style="width:100%;">
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/mastercard.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/visa.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/mir.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/applepay.png" class="small_product_img">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% include 'pc_utilites.html' %}
<script>


    function changeCounter(action) {
        console.log(Number(counter_product.value));
        if (action === 1) {
            counter_product.value += 1;
        } else {
            if (counter_product.value === 1) {
                minus_counter.classList.add('none_active');
                return;
            } else {
                counter_product.value -= 1;
            }
        }
    }

    /* Если чекбокс "Отправить другому человеку поставлен, то открываем блок "Получатель"" */
    get_other_people.onchange = function () {
        if (get_other_people.checked) {
            recipient.className = '_active';
        } else {
            recipient.classList.remove('_active');
        }
    }


    choose_data.onclick = function () {

    }


    money_payment.onchange = function () {
        if (card_payment.checked) {
            card_payment.checked = false;
        } else {
            money_payment.checked = true;
        }
    }
    card_payment.onchange = function () {
        if (money_payment.checked) {
            money_payment.checked = false;
        } else {
            card_payment.checked = true;
        }
    }


    /* Получение пользователя */
    GetUser();

    function GetUser() {
        $.ajax({
            url: '/api/user/get',
            type: 'GET',
            success: function (msg) {
                user = msg['user'];
                loadBasket();
            }
        });
    }


    function loadBasket() {
        let data = {
            'user_id': user['id'],
        }
        $.ajax({
            url: '/api/busket/get_by_user',
            data: data,
            type: 'GET',
            success: function (msg) {
                $('.delete_card').remove();
                let final_price = document.getElementsByClassName('final_price');
                for(let i = 0; i < final_price.length; i++){
                   final_price[i].innerText = msg['message']['busket']['discount_cost'] + ' ₽';
                }
                drawBasket(msg['message']['products']);
            }
        })
    }


    function drawBasket(products) {
        console.log(products, basket_id);
        for (let i = 0; i < products.length; i++) {
            let box = createProductBasket(products[i]);
            box.style.display = 'block';
            document.getElementById('basket_item_place').append(box);
        }
        document.getElementById('basket_item_place').style.display = 'block';
    }


</script>
</body>
</html>