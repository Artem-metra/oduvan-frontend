<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Оформление заказа</title>
    {% include 'pc_headers.html' %}
</head>
<body id="body">

<div class="catalog">
    <div class="container">
        <div class="place_breadcoast">
            <a href="">Главная</a> / <a href="">Оформление заказа</a>
        </div>

        <div class="catalog_flex createorder">
            <div class="requisites_place">
                <div class="name_buckets">
                    Отправитель
                </div>
                <input class="popup_input" placeholder="Ваше имя">
                <input class="popup_input" type="tel" placeholder="+7 (___) ___-__-__">
                <input class="popup_input" type="email" placeholder="Электронная почта">
                <select id="addresses_user" class="popup_input" style="display: none">

                </select>
                <div class="checkbox" style="margin-left:5px;">
                    <input type="checkbox" id="get_other_people"
                           class="scal_chek custom-checkbox" style="margin-top: 20px;">
                    <label for="get_other_people" class="lab_desc sub_zag">Отправить другому человеку</label>
                </div>
                <div id="recipient">
                    <div class="name_buckets">
                        Получатель
                    </div>
                    <input class="popup_input" placeholder="Имя получателя">
                    <input class="popup_input" type="tel" placeholder="+7 (___) ___-__-__">
                    <input class="popup_input" type="email" placeholder="Адрес получателя">
                </div>
                <div class="name_buckets">
                    Дополнительно
                </div>
                <input class="popup_input" placeholder="Комментарии к заказу">
                <input class="popup_input" placeholder="Текст для открытки">

                <div class="catalog_flex">
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="add_carrying"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="add_carrying" class="lab_desc sub_zag">Добавить переноску</label>
                    </div>
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="add_aquapack"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="add_aquapack" class="lab_desc sub_zag">Добавить аквапак</label>
                    </div>
                </div>


                <div class="name_buckets">
                    Способ оплаты
                </div>
                <div class="catalog_flex">
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="money_payment"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="money_payment" class="lab_desc sub_zag">Наличные</label>
                    </div>
                    <div class="checkbox" style="margin-left:5px;">
                        <input type="checkbox" id="card_payment"
                               class="scal_chek custom-checkbox" style="margin-top: 20px;">
                        <label for="card_payment" class="lab_desc sub_zag">Картой</label>
                    </div>
                </div>

                <div class="all_catalog_href"
                     style="float: none;width:100%;height:60px;justify-content: space-between;padding:0 10px">
                    <div class="pereiti_k_oform">Подтвердить заказ</div>
                    <div style="float: right" class="price">17200 Р</div>
                </div>

            </div>
            <div class="your_order_place">
                <div class="your_order">
                    <div class="name_buckets">
                        Ваш заказ
                    </div>
                    <div class="description_explanations">
                        <div class="catalog_flex">
                            <div class="address_info_zag">
                                Доставка в точное время
                            </div>
                            <span class="fa fa-chevron-down"></span>
                        </div>
                        <div class="catalog_flex" style="position: relative; ">
                            <div class="date_input" id="date_input_one">
                                <input type="date" class="popup_input" id="inp_choose_data" data-date-format="DD MMMM YYYY">
                            </div>
                            <div class="address_info_zag" id="addres_info_date">
                            <!--06.07.2021-->
                            </div>
                            <span id="choose_data">Выбрать дату</span>
                        </div>

                        <div class="catalog_flex" style="position: relative;">
                            <div class="date_input" id="date_input_two">
                                <input type="time" class="popup_input" id="inp_choose_time">
                            </div>
                            <div class="address_info_zag" id="addres_info_time">
                                <!--21:00-->
                            </div>
                            <span id="choose_time">Выбрать время</span>
                        </div>
                    </div>
                    <div class="catalog_flex" style="justify-content: space-between;padding:0">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            Сумма заказа
                        </div>
                        <div class="price_price" style="float: right">
                            16200 Р
                        </div>
                    </div>
                    <div class="registr_indicator" style="background: #293048; margin:10px 0;"></div>
                    <div class="catalog_flex" style="justify-content: space-between">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            + Доставка вовремя
                        </div>
                        <div class="price_price" style="float: right">
                            1000 Р
                        </div>
                    </div>

                    <div class="catalog_flex" style="align-items: normal;justify-content: normal">
                        <div class="small_product_card" style="margin-right:15px;">
                            <div class="small_product_place">
                                <img src="../static/img/slider_img.png" class="small_product_img">
                            </div>
                        </div>
                        <div>
                            <div class="bucket_na_zakaz">
                                Букет индиго
                            </div>
                            <div class="price">
                                5400 Р
                            </div>
                        </div>
                    </div>


                    <div class="catalog_flex" style="justify-content: space-between;margin-bottom: 0px;">
                        <div class="price_price" style="color:#293048;opacity:0.6">
                            Итого:
                        </div>
                        <div class="price_price" style="float: right">
                            17200 Р
                        </div>
                    </div>
                    <div class="registr_indicator" style="background: #293048;margin:10px 0;"></div>
                    <input class="popup_input" placeholder="Введите промокод">
                    <div class="all_catalog_href" style="float: none;width:100%;height:50px;">
                        Применить промокод
                    </div>
                    <div class="blog_item_text_zag" style="text-align: center;margin:20px 0;">Платёжные системы</div>
                    <div style="width:100%;">
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/mastercard.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/visa.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/mir.png" class="small_product_img">
                            </div>
                        </div>
                        <div class="system_item">
                            <div class="small_product_place">
                                <img src="../static/img/applepay.png" class="small_product_img">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>


{% include 'pc_utilites.html' %}
<script>
    // let user = null;

    function changeCounter(action) {
        console.log(Number(counter_product.value));
        if (action === 1) {
            counter_product.value += 1;
        } else {
            if (counter_product.value === 1) {
                minus_counter.classList.add('none_active');
                return;
            } else {
                counter_product.value -= 1;
            }
        }
    }

    /* Если чекбокс "Отправить другому человеку поставлен, то открываем блок "Получатель"" */
    get_other_people.onchange = function () {
        if (get_other_people.checked) {
            recipient.className = '_active';
        } else {
            recipient.classList.remove('_active');
        }
    }

    let timeElapsed = Date.now();
    let today = new Date(timeElapsed);
    let day_now = today.toLocaleDateString();
    addres_info_date.innerText = day_now;


    var todayy = new Date;
    let my_hours = todayy.getHours();
    let my_min = todayy.getMinutes();
    let my_full_time = my_hours + ':' + my_min;
    addres_info_time.innerText = my_full_time;


    const options = {
        year: 'numeric',
        month: 'numeric',
        day: 'numeric',
    }

    const date = new Date()
    date.setDate(date.getDate())

    const on_block = date.toLocaleString("ru", options).split('.').reverse().join('-')
    document.getElementById("inp_choose_data").setAttribute("min", on_block)



    let inp_data = document.getElementById('date_input_one');
    choose_data.onclick = function () {
        inp_data.classList.add('_active');
    }

    inp_choose_data.onchange = function (){

        let data_value = inp_choose_data.value;
        inp_data.classList.remove('_active');
        addres_info_date.innerText = data_value;
    }



    let inp_time = document.getElementById('date_input_two');
    choose_time.onclick = function (){
       inp_time.classList.add('_active');
    }

    inp_choose_time.onchange = function (){
        let time_value = inp_choose_time.value;
        inp_time.classList.remove('_active');
        addres_info_time.innerText = time_value;
    }



    money_payment.onchange = function () {
        if (card_payment.checked) {
            card_payment.checked = false;
        } else {
            money_payment.checked = true;
        }
    }
    card_payment.onchange = function () {
        if (money_payment.checked) {
            money_payment.checked = false;
        } else {
            card_payment.checked = true;
        }
    }


    /* Получение пользователя */
    GetUser();

    function GetUser() {
        $.ajax({
            url: '/api/user/get',
            type: 'GET',
            success: function (msg) {
                if (msg['status'] === 'error') {
                    favorites.onclick = function () {
                        OpenPopup(registrationpopup, 1);
                    }
                    go_to_basket.onclick = function () {
                        OpenPopup(registrationpopup, 1);
                    }
                    user_item.onclick = function () {
                        OpenPopup(registrationpopup, 1);
                    }
                } else {
                    user = msg['user'];
                    console.log(user);
                    favorites.href = '/favorites';
                    go_to_basket.onclick = function () {
                        OpenPopup(basket_popup, 2);
                    }
                    user_item.href = '/cabinet';

                    if (user['addresses'].length > 0) {
                        for (let i = 0; i < user['addresses'].length; i++) {
                            let option = document.createElement('option');
                            option.value = user['addresses'][i];
                            option.innerText = user['addresses'][i];
                            addresses_user.append(option);
                        }
                        addresses_user.style.display = 'block';
                    }

                }
            }
        });
    }


</script>
</body>
</html>